<!DOCTYPE html>
<html>
    <head>
        <script src="basics/jq.js"></script>
        <script src="basics/three.js"></script>
        <script src="basics/LLA.js"></script>
        <script src="basics/LVR.js"></script>
        <script src="basics/LDevice.js"></script>
        <script src="basics/LCamera.js"></script>
        <script src="cannon.js"></script>
        <script src="cam.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="index.css">
    </head>
    <body>
        
        <!--
            to-do: implement selecting camera type

        -->
        
        
        <img id="cameraToggle" src="camera.png" onclick="$('#cameraMenu').toggle(),$('#mainMenu').hide()">
        <img id="menuToggle" src="menu.png" onclick="$('#mainMenu').toggle(),$('#cameraMenu').hide()">
        
        
        <div class="menuSection" id="mainMenu">
            <button onclick="interact()">interact</button>
        </div>
        
        <div class="menuSection" id="cameraMenu">
            <button onclick="lc.kill(),$('#cameraMenu').toggle()">none</button>
            <button onclick="lc.startKeyboard(),$('#cameraMenu').toggle()">keyboard</button>
            <button onclick="">mouse/keyboard</button>
            <button onclick="">touch</button>
            <button onclick="lc.startVR(),$('#cameraMenu').toggle()">_vr</button>
        </div>
        
        <div id="LeftJoyStickSide">
            <div id="LJSOuter"></div>
            <div id="LJSInner"></div>
            
        </div>
        
        <script src="obj.js"></script>
        <script src="index.js"></script>
        <script>
            
            function JoyStick(outsideDivId, outerJSId, innerJSId){
                //get references,
                var container = $('#'+outsideDivId);
                var outer = $('#'+outerJSId);
                var outerSize = new LV2(outer.width(),outer.height());
                var inner = $('#'+innerJSId);
                var innerSize = new LV2(inner.width(),inner.height());
                var position = new LV2(-1, -1);
                var starting_position = position.copy();
                var device = new LDevice();
                var id = -1;
                
                
                container.show();
                
                var hide = function(){
                    outer.hide();
                    inner.hide();
                };
                var show = function(){
                    outer.show();
                    inner.show();
                };
                
                var setPosition = function(element, position){
                    element.css('left',position.x+'px');
                    element.css('top',position.y+'px');
                };
                
                hide();
                
                //return a function which kills it all
                device.touch(document.getElementById(outsideDivId), function(event){
                    if(id == -1 && event.type == 'start'){
                        id = event.id;
                        starting_position = new LV2(event.x, event.y);
                        position = starting_position.copy();
                        setPosition(outer, starting_position.sub(outerSize.scale(0.5)));
                        show();
                    }else if(event.type == 'end'){
                        hide();
                        id = -1;
                    }else if(id != -1 && event.type == 'move'){
                        position = new LV2(event.x, event.y);
                    }
                    
                    
                    
                    if(id != -1){
                        var distance = position.dist(starting_position);
                        var output_position = position.copy().sub(starting_position)
                        .unit().scale(Math.min(outerSize.x*0.5,distance));
                        output_position.iadd(starting_position);
                        setPosition(inner, output_position.sub(innerSize.scale(0.5)));
                    }
                });
            }
            
            JoyStick('LeftJoyStickSide', 'LJSOuter', 'LJSInner');
            
            
        
            (function(){
                var dev = new LDevice();
                var id = -1;
                var p = new LV2(-1,-1);
                var sp = new LV2(-1,-1);
                var js = $('#LJSInner');
                var dv = $('#LeftJoyStickSide');
                var dvi = $('#LJSOuter');
                js.hide();
                dvi.hide();
                dev.touch(document.getElementById('LeftJoyStickSide'), function(e){
                    if(id == -1 && e.type == 'start'){
                        id = e.id;
                        p.x = e.x;
                        p.y = e.y;
                        sp = p.copy();
                        js.show();
                        dvi.show();
                    }else if(e.type == 'end' && e.id == id){
                        id = -1;
                        js.hide();
                        dvi.hide();
                    }else if(e.type == 'move' && id == e.id){
                        p.x = e.x;
                        p.y = e.y;
                    }
                    
                    if(id != -1){
                        var distance = position.distance(starting_position);
                        var output_position = position.copy().sub(starting_position)
                        .unit().scale(Math.min(50,distance));
                        output_position.iadd(startin_position);
                        js.css('left',(np.x-40)+'px');
                        js.css('top',(np.y-40)+'px');
                        var _ = 100/2;
                        dvi.css('left',(sp.x-_)+'px');
                        dvi.css('top',(sp.y-_)+'px');
                        
                    }
                });
            });
        
        </script>
    </body>
</html>